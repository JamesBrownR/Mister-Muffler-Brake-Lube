<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Mister Muffler Brake & Lube ‚Äî Professional Auto Service in Stillwater, OK</title>
<meta name="description" content="Expert brake service, mufflers, oil changes & alignments in Stillwater, OK. Fast, honest, reliable auto repair since 1985. Call (405) 372-9500." />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg-primary: #0a0f1c;
    --bg-secondary: #111827;
    --bg-card: #1f2937;
    --bg-glass: rgba(31, 41, 55, 0.8);
    --accent-primary: #dc2626;
    --accent-secondary: #ef4444;
    --accent-gradient: linear-gradient(135deg, #dc2626, #ef4444);
    --text-primary: #f9fafb;
    --text-secondary: #d1d5db;
    --text-muted: #9ca3af;
    --border: rgba(255, 255, 255, 0.1);
    --success: #10b981;
    --warning: #f59e0b;
    --shadow-lg: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
    --shadow-xl: 0 35px 60px -15px rgba(0, 0, 0, 0.6);
    --max-width: 1200px;
    --radius-sm: 8px;
    --radius-md: 12px;
    --radius-lg: 16px;
  }

  * {
    box-sizing: border-box;
  }

  body {
    margin: 0;
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
    color: var(--text-primary);
    line-height: 1.6;
    font-size: 16px;
    overflow-x: hidden;
  }

  .container {
    max-width: var(--max-width);
    margin: 0 auto;
    padding: 20px;
  }

  /* Header Styles */
  header {
    background: var(--bg-glass);
    backdrop-filter: blur(20px);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    padding: 24px;
    margin-bottom: 32px;
    box-shadow: var(--shadow-lg);
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 20px;
  }

  .brand {
    display: flex;
    align-items: center;
    gap: 20px;
  }

  .logo {
    width: 88px;
    height: 88px;
    background: var(--accent-gradient);
    border-radius: var(--radius-md);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 28px;
    color: white;
    box-shadow: 0 8px 32px rgba(220, 38, 38, 0.3);
    position: relative;
    overflow: hidden;
  }

  .logo::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
    transform: translateX(-100%);
    animation: shine 3s infinite;
  }

  @keyframes shine {
    0% { transform: translateX(-100%); }
    50% { transform: translateX(100%); }
    100% { transform: translateX(100%); }
  }

  .brand-text h1 {
    margin: 0;
    font-size: 24px;
    font-weight: 700;
    background: linear-gradient(135deg, var(--text-primary), var(--text-secondary));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .brand-text .tagline {
    color: var(--text-muted);
    font-size: 14px;
    margin: 4px 0 0 0;
  }

  .header-contact {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 12px;
  }

  .call-now {
    background: var(--accent-gradient);
    color: white;
    padding: 14px 24px;
    border-radius: var(--radius-md);
    text-decoration: none;
    font-weight: 600;
    font-size: 16px;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s ease;
    box-shadow: 0 4px 20px rgba(220, 38, 38, 0.25);
  }

  .call-now:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 30px rgba(220, 38, 38, 0.4);
  }

  .call-now:active {
    transform: translateY(0);
  }

  .hours-badge {
    background: rgba(16, 185, 129, 0.1);
    color: var(--success);
    padding: 8px 12px;
    border-radius: var(--radius-sm);
    font-size: 14px;
    font-weight: 500;
    border: 1px solid rgba(16, 185, 129, 0.2);
  }

  /* Main Layout */
  main {
    display: flex;
    flex-direction: column;
    gap: 32px;
    margin-bottom: 40px;
  }

  /* Card Styles */
  .card {
    background: var(--bg-glass);
    backdrop-filter: blur(20px);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    padding: 24px;
    box-shadow: var(--shadow-lg);
    transition: all 0.3s ease;
  }

  .card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-xl);
  }

  .card h2, .card h3 {
    margin: 0 0 16px 0;
    color: var(--text-primary);
  }

  .card h2 {
    font-size: 28px;
    font-weight: 700;
  }

  .card h3 {
    font-size: 20px;
    font-weight: 600;
  }

  /* Hero Section */
  .hero {
    margin-bottom: 24px;
  }

  .hero-text {
    font-size: 18px;
    color: var(--text-secondary);
    margin-bottom: 24px;
    line-height: 1.7;
  }

  .status-badges {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    margin-bottom: 32px;
  }

  .badge {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid var(--border);
    padding: 10px 16px;
    border-radius: var(--radius-md);
    font-size: 14px;
    font-weight: 500;
    backdrop-filter: blur(10px);
  }

  .badge.open {
    background: rgba(16, 185, 129, 0.1);
    border-color: rgba(16, 185, 129, 0.3);
    color: var(--success);
  }

  /* Services Grid */
  .services-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px;
    margin: 24px 0;
  }

  .service-card {
    background: rgba(255, 255, 255, 0.02);
    border: 1px solid var(--border);
    border-radius: var(--radius-md);
    padding: 20px;
    text-align: center;
    transition: all 0.3s ease;
    cursor: default;
  }

  .service-card:hover {
    background: rgba(220, 38, 38, 0.05);
    border-color: rgba(220, 38, 38, 0.3);
    transform: translateY(-2px);
  }

  .service-icon {
    font-size: 24px;
    margin-bottom: 8px;
    display: block;
  }

  .service-card h4 {
    margin: 0;
    font-size: 16px;
    font-weight: 600;
    color: var(--text-primary);
  }

  /* Map Section */
  .map-container {
    margin: 24px 0;
    border-radius: var(--radius-md);
    overflow: hidden;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
  }

  .map-frame {
    width: 100%;
    height: 300px;
    border: 0;
  }

  /* Gallery */
  .gallery {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 12px;
    margin: 24px 0;
  }

  .gallery img {
    width: 100%;
    height: 120px;
    object-fit: cover;
    border-radius: var(--radius-sm);
    transition: transform 0.3s ease;
    cursor: pointer;
  }

  .gallery img:hover {
    transform: scale(1.05);
  }

  /* Sidebar - no longer needed as separate styles */

  /* Hours Table */
  .hours-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
  }

  .hours-table th,
  .hours-table td {
    padding: 12px 16px;
    text-align: left;
    border-bottom: 1px solid var(--border);
  }

  .hours-table th {
    background: rgba(255, 255, 255, 0.02);
    font-weight: 600;
    color: var(--text-primary);
  }

  .hours-table td {
    color: var(--text-secondary);
  }

  .hours-table .today {
    background: rgba(220, 38, 38, 0.05);
    color: var(--accent-secondary);
    font-weight: 600;
  }

  .hours-table .closed {
    color: var(--text-muted);
    font-style: italic;
  }

  /* Reviews */
  .review {
    background: rgba(255, 255, 255, 0.02);
    border: 1px solid var(--border);
    border-radius: var(--radius-md);
    padding: 16px;
    margin-bottom: 12px;
    transition: all 0.3s ease;
  }

  .review:hover {
    background: rgba(255, 255, 255, 0.04);
  }

  .review-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 8px;
  }

  .avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: var(--accent-gradient);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    color: white;
    font-size: 14px;
  }

  .review-meta h5 {
    margin: 0;
    font-size: 16px;
    font-weight: 600;
    color: var(--text-primary);
  }

  .stars {
    display: flex;
    gap: 2px;
    margin: 2px 0;
  }

  .star {
    width: 16px;
    height: 16px;
  }

  .review-text {
    color: var(--text-secondary);
    font-size: 14px;
    line-height: 1.5;
  }

  /* Contact Form */
  .form-group {
    margin-bottom: 20px;
  }

  .form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
    color: var(--text-primary);
  }

  .form-control {
    width: 100%;
    padding: 12px 16px;
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    background: rgba(255, 255, 255, 0.02);
    color: var(--text-primary);
    font-size: 16px;
    transition: all 0.3s ease;
  }

  .form-control:focus {
    outline: none;
    border-color: var(--accent-primary);
    box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
  }

  textarea.form-control {
    min-height: 120px;
    resize: vertical;
  }

  .btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 12px 24px;
    border: none;
    border-radius: var(--radius-sm);
    font-size: 16px;
    font-weight: 600;
    text-decoration: none;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .btn-primary {
    background: var(--accent-gradient);
    color: white;
    box-shadow: 0 4px 20px rgba(220, 38, 38, 0.25);
  }

  .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 30px rgba(220, 38, 38, 0.4);
  }

  .btn-secondary {
    background: rgba(255, 255, 255, 0.05);
    color: var(--text-primary);
    border: 1px solid var(--border);
  }

  .btn-secondary:hover {
    background: rgba(255, 255, 255, 0.1);
  }

  /* Footer */
  footer {
    background: var(--bg-glass);
    backdrop-filter: blur(20px);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    padding: 32px;
    text-align: center;
    margin-top: 40px;
  }

  .footer-content {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 32px;
    margin-bottom: 24px;
  }

  .footer-section h4 {
    margin: 0 0 16px 0;
    color: var(--text-primary);
    font-weight: 600;
  }

  .footer-section p,
  .footer-section a {
    color: var(--text-secondary);
    text-decoration: none;
    margin: 8px 0;
  }

  .footer-section a:hover {
    color: var(--accent-secondary);
  }

  .footer-bottom {
    border-top: 1px solid var(--border);
    padding-top: 24px;
    color: var(--text-muted);
    font-size: 14px;
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    .container {
      padding: 16px;
    }
    
    header {
      flex-direction: column;
      text-align: center;
    }
    
    .brand {
      flex-direction: column;
      text-align: center;
    }
    
    .brand-text h1 {
      font-size: 20px;
    }
    
    .services-grid {
      grid-template-columns: 1fr;
    }
    
    .gallery {
      grid-template-columns: repeat(2, 1fr);
    }
    
    .footer-content {
      grid-template-columns: 1fr;
      text-align: center;
    }
  }

  /* Animations */
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .animate-fade-in {
    animation: fadeInUp 0.6s ease forwards;
  }
</style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true">MM</div>
        <div class="brand-text">
          <h1>Mister Muffler Brake & Lube</h1>
          <p class="tagline">408 E 9th Ave, Stillwater, OK 74074</p>
        </div>
      </div>
      
      <div class="header-contact">
        <div class="hours-badge" id="currentStatus">Open Today</div>
        <a class="call-now" href="tel:+14053729500" aria-label="Call Mister Muffler Brake and Lube">
          üìû (405) 372-9500
        </a>
      </div>
    </header>

    <main>
      <!-- Main Content -->
      <section>
        <!-- Hero Section -->
        <div class="card hero animate-fade-in">
          <h2>Professional Auto Service You Can Trust</h2>
          <p class="hero-text">
            For over 35 years, Mister Muffler has been Stillwater's trusted choice for brake repairs, 
            mufflers, oil changes, and alignments. Our experienced technicians provide fast, honest, 
            and reliable service to keep your vehicle running safely.
          </p>
          
          <div class="status-badges">
            <div class="badge open" id="statusBadge">üü¢ Open Now</div>
            <div class="badge">‚ö° Same-Day Service</div>
            <div class="badge">üõ°Ô∏è Licensed & Insured</div>
            <div class="badge">üíØ Satisfaction Guaranteed</div>
          </div>

          <!-- Services -->
          <h3>Our Services</h3>
          <div class="services-grid">
            <div class="service-card">
              <span class="service-icon">üöó</span>
              <h4>Brake Repair</h4>
            </div>
            <div class="service-card">
              <span class="service-icon">üîß</span>
              <h4>Mufflers & Exhaust</h4>
            </div>
            <div class="service-card">
              <span class="service-icon">üõ¢Ô∏è</span>
              <h4>Oil Changes</h4>
            </div>
            <div class="service-card">
              <span class="service-icon">‚öôÔ∏è</span>
              <h4>Wheel Alignment</h4>
            </div>
            <div class="service-card">
              <span class="service-icon">üõû</span>
              <h4>Tire Service</h4>
            </div>
            <div class="service-card">
              <span class="service-icon">üîç</span>
              <h4>Inspections</h4>
            </div>
          </div>
        </div>

        <!-- Location & Map -->
        <div class="card animate-fade-in">
          <h3>üìç Find Us</h3>
          <p>Located on East 9th Avenue in the heart of Stillwater, we're easy to find and convenient to reach.</p>
          <div class="map-container">
            <iframe 
              class="map-frame" 
              src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3387.50707726628!2d-97.05578968482112!3d36.112700279971176!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x87b10a2452bda985%3A0x67d2e7b29640c13c!2sMister%20Muffler%20Brake%20%26%20Lube!5e0!3m2!1sen!2sus!4v1694960000000!5m2!1sen!2sus" 
              loading="lazy" 
              referrerpolicy="no-referrer-when-downgrade" 
              aria-label="Mister Muffler Brake & Lube location">
            </iframe>
          </div>
        </div>



        <!-- Contact Form -->
        <div class="card animate-fade-in">
          <h3>‚úâÔ∏è Get In Touch</h3>
          <p>Have questions about your vehicle? Need a quote? Send us a message and we'll get back to you promptly.</p>
          
          <form id="contactForm">
            <div class="form-group">
              <label for="name">Full Name *</label>
              <input type="text" id="name" name="name" class="form-control" required placeholder="Your full name">
            </div>
            
            <div class="form-group">
              <label for="email">Email Address *</label>
              <input type="email" id="email" name="email" class="form-control" required placeholder="your@email.com">
            </div>
            
            <div class="form-group">
              <label for="phone">Phone Number</label>
              <input type="tel" id="phone" name="phone" class="form-control" placeholder="(405) 555-0123">
            </div>
            
            <div class="form-group">
              <label for="message">Message *</label>
              <textarea id="message" name="message" class="form-control" required placeholder="Tell us about your vehicle, service needed, or any questions you have..."></textarea>
            </div>
            
            <div style="display: flex; gap: 12px; flex-wrap: wrap;">
              <button type="submit" class="btn btn-primary">üìß Send Message</button>
              <button type="button" id="submitAjax" class="btn btn-secondary">üöÄ Send via AJAX</button>
            </div>
            
            <p id="formNote" style="margin-top: 12px; color: var(--text-muted); font-size: 14px;"></p>
          </form>
        </div>
      </section>

      <!-- Sidebar -->
      <aside class="sidebar">
        <!-- Hours -->
        <div class="card animate-fade-in">
          <h3>üïí Business Hours</h3>
          <table class="hours-table">
            <tbody>
              <tr data-day="0" class="closed">
                <td><strong>Sunday</strong></td>
                <td>Closed</td>
              </tr>
              <tr data-day="1">
                <td><strong>Monday</strong></td>
                <td>8:00 AM - 5:30 PM</td>
              </tr>
              <tr data-day="2">
                <td><strong>Tuesday</strong></td>
                <td>8:00 AM - 5:30 PM</td>
              </tr>
              <tr data-day="3">
                <td><strong>Wednesday</strong></td>
                <td>8:00 AM - 5:30 PM</td>
              </tr>
              <tr data-day="4">
                <td><strong>Thursday</strong></td>
                <td>8:00 AM - 5:30 PM</td>
              </tr>
              <tr data-day="5">
                <td><strong>Friday</strong></td>
                <td>8:00 AM - 5:30 PM</td>
              </tr>
              <tr data-day="6">
                <td><strong>Saturday</strong></td>
                <td>8:00 AM - 12:00 PM</td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Reviews -->
        <div class="card animate-fade-in">
          <h3>‚≠ê Customer Reviews</h3>
          <div id="reviews" class="reviews-list" aria-live="polite"></div>
          <div style="text-align: center; margin-top: 16px;">
            <button id="showMoreBtn" class="btn btn-secondary" style="display: none;">Show More Reviews</button>
          </div>
        </div>

        <!-- Quick Contact -->
        <div class="card animate-fade-in">
          <h3>üìû Quick Contact</h3>
          <p style="color: var(--text-secondary); margin-bottom: 24px;">Get in touch with us for all your automotive service needs. We're here to help!</p>
          
          <div style="margin-bottom: 24px;">
            <strong style="display: block; margin-bottom: 8px; color: var(--text-primary);">üì± Phone</strong>
            <a class="call-now" href="tel:+14053729500" style="margin-bottom: 8px; display: inline-flex;">
              üìû (405) 372-9500
            </a>
            <p style="font-size: 14px; color: var(--text-muted); margin: 0;">Call us for appointments or questions</p>
          </div>
          
          <div style="margin-bottom: 24px;">
            <strong style="display: block; margin-bottom: 8px; color: var(--text-primary);">‚úâÔ∏è Email</strong>
            <a href="mailto:info@mistermuffler.com" style="color: var(--accent-secondary); text-decoration: none; font-weight: 500;">info@mistermuffler.com</a>
            <p style="font-size: 14px; color: var(--text-muted); margin: 4px 0 0 0;">Send us your questions anytime</p>
          </div>
          
          <div style="margin-bottom: 24px;">
            <strong style="display: block; margin-bottom: 8px; color: var(--text-primary);">üìç Address</strong>
            <address style="color: var(--text-secondary); font-style: normal; line-height: 1.6;">
              408 E 9th Ave<br>
              Stillwater, OK 74074
            </address>
            <p style="font-size: 14px; color: var(--text-muted); margin: 4px 0 0 0;">Easy to find on East 9th Avenue</p>
          </div>
          
          <div style="padding: 16px; background: rgba(16, 185, 129, 0.05); border: 1px solid rgba(16, 185, 129, 0.2); border-radius: var(--radius-sm);">
            <strong style="color: var(--success); display: block; margin-bottom: 4px;">‚ö° Same-Day Service Available</strong>
            <p style="font-size: 14px; color: var(--text-secondary); margin: 0;">Most repairs completed while you wait</p>
          </div>
        </div>
      </aside>
    </main>

    <!-- Footer -->
    <footer>
      <div class="footer-content">
        <div class="footer-section">
          <h4>Mister Muffler Brake & Lube</h4>
          <p>Your trusted auto service partner since 1985</p>
          <p>Licensed, insured, and committed to excellence</p>
        </div>
        
        <div class="footer-section">
          <h4>Services</h4>
          <p>‚Ä¢ Brake Repair & Service</p>
          <p>‚Ä¢ Muffler & Exhaust Systems</p>
          <p>‚Ä¢ Oil Changes & Lubrication</p>
          <p>‚Ä¢ Wheel Alignment & Balancing</p>
          <p>‚Ä¢ Tire Installation & Repair</p>
        </div>
        
        <div class="footer-section">
          <h4>Contact Info</h4>
          <p>üìû <a href="tel:+14053729500">(405) 372-9500</a></p>
          <p>‚úâÔ∏è <a href="mailto:info@mistermuffler.com">info@mistermuffler.com</a></p>
          <p>üìç 408 E 9th Ave, Stillwater, OK 74074</p>
        </div>
      </div>
      
      <div class="footer-bottom">
        <p>&copy; <span id="year"></span> Mister Muffler Brake & Lube. All rights reserved.</p>
        <p>Professional automotive service you can trust.</p>
      </div>
    </footer>
  </div>

<script>
// Configuration
const SQUARE_LOCATION_ID = 'YOUR_LOCATION_ID';

// Sample reviews data - replace with real reviews
const reviewsData = [
  { name: "Sarah Johnson", rating: 5, body: "Excellent service! Fixed my brake issue quickly and at a fair price. Highly recommend!" },
  { name: "Mike Rodriguez", rating: 5, body: "Been coming here for years. Always honest, reliable, and professional. Best shop in town!" },
  { name: "Jennifer Smith", rating: 5, body: "Great customer service and quality work. They explained everything clearly and finished on time." },
  { name: "David Chen", rating: 5, body: "Fair pricing and expert service. Fixed my muffler problem perfectly. Will definitely return!" },
  { name: "Lisa Thompson", rating: 5, body: "Professional staff and quick turnaround. My car runs like new after their service." },
  { name: "Robert Wilson", rating: 5, body: "Trustworthy mechanics who do quality work. They've serviced my family's cars for over 10 years." },
  { name: "Amanda Davis", rating: 5, body: "Fast oil change service and they checked all my fluids. Great attention to detail!" },
  { name: "Kevin Martinez", rating: 5, body: "Had my alignment done here - car drives perfectly straight now. Professional and efficient." },
  { name: "Rachel Brown", rating: 5, body: "Honest diagnosis and fair pricing. They didn't try to sell me unnecessary services." },
  { name: "Tom Anderson", rating: 5, body: "Emergency brake repair handled quickly. Got me back on the road safely. Thank you!" },
  { name: "Maria Garcia", rating: 5, body: "Clean shop, friendly staff, and excellent workmanship. Highly recommend to everyone!" },
  { name: "James Taylor", rating: 5, body: "Best muffler shop in Stillwater! Quality parts and expert installation. Very satisfied." },
  { name: "Nicole White", rating: 5, body: "Great service from start to finish. They explained the repair process and kept me informed." }
];

// Reviews display logic
const REVIEWS_PER_STEP = 4;
let showCount = Math.min(REVIEWS_PER_STEP, reviewsData.length);

function createStarSVG(filled) {
  if (filled) {
    return '<svg class="star" viewBox="0 0 24 24" fill="#fbbf24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>';
  } else {
    return '<svg class="star" viewBox="0 0 24 24" fill="rgba(255,255,255,0.2)"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>';
  }
}

function renderReviews() {
  const container = document.getElementById('reviews');
  container.innerHTML = '';
  
  for (let i = 0; i < showCount && i < reviewsData.length; i++) {
    const review = reviewsData[i];
    const div = document.createElement('div');
    div.className = 'review';
    
    const initials = review.name.split(' ').map(n => n[0]).join('').toUpperCase();
    const stars = Array.from({length: 5}, (_, i) => createStarSVG(i < review.rating)).join('');
    
    div.innerHTML = `
      <div class="review-header">
        <div class="avatar">${initials}</div>
        <div class="review-meta">
          <h5>${escapeHtml(review.name)}</h5>
          <div class="stars" aria-label="${review.rating} out of 5 stars">${stars}</div>
        </div>
      </div>
      ${review.body ? `<p class="review-text">${escapeHtml(review.body)}</p>` : ''}
    `;
    container.appendChild(div);
  }

  const showMoreBtn = document.getElementById('showMoreBtn');
  const total = reviewsData.length;
  
  if (showCount < total) {
    const remaining = total - showCount;
    showMoreBtn.style.display = 'inline-flex';
    showMoreBtn.textContent = `Show ${remaining} More Reviews`;
  } else {
    if (total > REVIEWS_PER_STEP) {
      showMoreBtn.style.display = 'inline-flex';
      showMoreBtn.textContent = 'Show Less';
    } else {
      showMoreBtn.style.display = 'none';
    }
  }
}

function escapeHtml(unsafe) {
  return String(unsafe)
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;")
    .replace(/'/g, "&#039;");
}

// Business hours logic
function updateBusinessStatus() {
  const now = new Date();
  const day = now.getDay(); // 0 = Sunday, 1 = Monday, etc.
  const hour = now.getHours();
  const minute = now.getMinutes();
  const currentTime = hour * 60 + minute;
  
  // Business hours in minutes from midnight
  const hours = {
    0: null, // Sunday - closed
    1: {open: 8 * 60, close: 17 * 60 + 30}, // Monday 8:00-17:30
    2: {open: 8 * 60, close: 17 * 60 + 30}, // Tuesday
    3: {open: 8 * 60, close: 17 * 60 + 30}, // Wednesday
    4: {open: 8 * 60, close: 17 * 60 + 30}, // Thursday
    5: {open: 8 * 60, close: 17 * 60 + 30}, // Friday
    6: {open: 8 * 60, close: 12 * 60}       // Saturday 8:00-12:00
  };
  
  const todayHours = hours[day];
  let isOpen = false;
  let statusText = 'Closed';
  let statusClass = 'closed';
  
  if (todayHours && currentTime >= todayHours.open && currentTime < todayHours.close) {
    isOpen = true;
    statusText = 'Open Now';
    statusClass = 'open';
  } else if (day === 0) {
    statusText = 'Closed Today';
  }
  
  // Update status elements
  const statusBadge = document.getElementById('statusBadge');
  const currentStatus = document.getElementById('currentStatus');
  
  if (statusBadge) {
    statusBadge.textContent = isOpen ? 'üü¢ Open Now' : 'üî¥ ' + statusText;
    statusBadge.className = `badge ${statusClass}`;
  }
  
  if (currentStatus) {
    currentStatus.textContent = statusText;
    currentStatus.className = `hours-badge ${statusClass}`;
  }
  
  // Highlight today in hours table
  const rows = document.querySelectorAll('.hours-table tr[data-day]');
  rows.forEach(row => {
    const rowDay = parseInt(row.dataset.day);
    if (rowDay === day) {
      row.classList.add('today');
    } else {
      row.classList.remove('today');
    }
  });
}

// Contact form handling
document.getElementById('contactForm').addEventListener('submit', function(e) {
  e.preventDefault();
  
  const name = document.getElementById('name').value.trim();
  const email = document.getElementById('email').value.trim();
  const phone = document.getElementById('phone').value.trim();
  const message = document.getElementById('message').value.trim();
  
  if (!name || !email || !message) {
    document.getElementById('formNote').textContent = 'Please fill in all required fields.';
    return;
  }
  
  // Create mailto link
  const subject = encodeURIComponent(`Service Inquiry from ${name}`);
  const body = encodeURIComponent(
    `Name: ${name}\n` +
    `Email: ${email}\n` +
    `Phone: ${phone || 'Not provided'}\n\n` +
    `Message:\n${message}\n\n` +
    `Sent from: Mister Muffler website`
  );
  
  const mailto = `mailto:info@mistermuffler.com?subject=${subject}&body=${body}`;
  window.location.href = mailto;
  
  document.getElementById('formNote').textContent = 'Opening your email client...';
});

// AJAX form submission (optional)
document.getElementById('submitAjax').addEventListener('click', async function() {
  const name = document.getElementById('name').value.trim();
  const email = document.getElementById('email').value.trim();
  const phone = document.getElementById('phone').value.trim();
  const message = document.getElementById('message').value.trim();
  
  if (!name || !email || !message) {
    document.getElementById('formNote').textContent = 'Please fill in all required fields.';
    return;
  }
  
  document.getElementById('formNote').textContent = 'Sending message...';
  
  try {
    // Replace with your actual endpoint
    const endpoint = 'https://formspree.io/f/your-form-id'; // Update this URL
    
    const response = await fetch(endpoint, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        name,
        email,
        phone,
        message,
        location: SQUARE_LOCATION_ID,
        source: 'Mister Muffler Website'
      })
    });
    
    if (response.ok) {
      document.getElementById('formNote').textContent = 'Message sent successfully! We\'ll get back to you soon.';
      document.getElementById('contactForm').reset();
    } else {
      throw new Error('Server error');
    }
  } catch (error) {
    document.getElementById('formNote').textContent = 'Unable to send via AJAX. Please use the regular send button to open your email client.';
    console.error('Form submission error:', error);
  }
});

// Show more/less reviews
document.getElementById('showMoreBtn').addEventListener('click', function() {
  const total = reviewsData.length;
  if (showCount < total) {
    showCount = Math.min(total, showCount + REVIEWS_PER_STEP);
  } else {
    showCount = Math.min(REVIEWS_PER_STEP, total);
  }
  renderReviews();
});

// Smooth scroll for internal links
document.addEventListener('click', function(e) {
  if (e.target.matches('a[href^="#"]')) {
    e.preventDefault();
    const target = document.querySelector(e.target.getAttribute('href'));
    if (target) {
      target.scrollIntoView({
        behavior: 'smooth',
        block: 'start'
      });
    }
  }
});

// Image gallery modal (basic implementation)
document.addEventListener('click', function(e) {
  if (e.target.matches('.gallery img')) {
    // Simple image preview - you could enhance this with a proper modal
    const img = e.target;
    const modal = document.createElement('div');
    modal.style.cssText = `
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      cursor: pointer;
    `;
    
    const modalImg = document.createElement('img');
    modalImg.src = img.src;
    modalImg.style.cssText = `
      max-width: 90%;
      max-height: 90%;
      border-radius: 12px;
      box-shadow: 0 25px 50px rgba(0,0,0,0.5);
    `;
    
    modal.appendChild(modalImg);
    document.body.appendChild(modal);
    
    modal.addEventListener('click', function() {
      document.body.removeChild(modal);
    });
  }
});

// Initialize
document.addEventListener('DOMContentLoaded', function() {
  // Set current year
  document.getElementById('year').textContent = new Date().getFullYear();
  
  // Update business status
  updateBusinessStatus();
  
  // Update status every minute
  setInterval(updateBusinessStatus, 60000);
  
  // Render reviews
  renderReviews();
  
  // Add animation delays to cards
  const cards = document.querySelectorAll('.animate-fade-in');
  cards.forEach((card, index) => {
    card.style.animationDelay = `${index * 0.1}s`;
  });
  
  // Performance optimization: lazy load images
  if ('IntersectionObserver' in window) {
    const imageObserver = new IntersectionObserver((entries, observer) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const img = entry.target;
          if (img.dataset.src) {
            img.src = img.dataset.src;
            img.removeAttribute('data-src');
          }
          observer.unobserve(img);
        }
      });
    });
    
    document.querySelectorAll('img[data-src]').forEach(img => {
      imageObserver.observe(img);
    });
  }
});

// Service Worker registration for PWA capabilities (optional)
if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('/sw.js').then(function(registration) {
      console.log('ServiceWorker registration successful');
    }, function(err) {
      console.log('ServiceWorker registration failed: ', err);
    });
  });
}
</script>
</body>
</html>
